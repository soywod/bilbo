---
export const prerender = false;

import Base from "../layouts/Base.astro";
import DiscussionIsland from "../components/DiscussionIsland";

const user = Astro.locals.user;
---

<Base
  title="Discussion IA — Bilbo"
  description="Posez vos questions sur les livres de la bibliothèque numérique Bilbo."
>
  <div class="discussion-page">
    <div class="discussion-header">
      <h1>Recherche par discussion IA</h1>
      <span class="discussion-user">
        {user?.email}
        <button id="logout-btn" class="logout-btn">Déconnexion</button>
      </span>
    </div>
    <p>
      Posez vos questions sur les livres de la bibliothèque. Bilbo cherchera les
      passages pertinents pour vous répondre.
    </p>
    <DiscussionIsland client:load />
  </div>
</Base>

<script>
  import { createSupabaseBrowser } from "../lib/supabase";

  document.getElementById("logout-btn")?.addEventListener("click", async () => {
    const supabase = createSupabaseBrowser();
    await supabase.auth.signOut();
    window.location.href = "/";
  });
</script>
